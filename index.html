<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libPeConv: libPeConv</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">libPeConv
   </div>
   <div id="projectbrief">A library to load, manipulate, dump PE files.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">libPeConv </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__r_e_a_d_m_e"></a><a href="https://ci.appveyor.com/project/hasherezade/libpeconv"><img src="https://ci.appveyor.com/api/projects/status/pqo6ob148pf5b352?svg=true" alt="Build status" class="inline"/></a> <a href="https://app.codacy.com/gh/hasherezade/libpeconv/dashboard?branch=master"><img src="https://api.codacy.com/project/badge/Grade/55911b033cf145d38d6e38a0c005b686" alt="Codacy Badge" class="inline"/></a> <a href="https://github.com/hasherezade/libpeconv/commits"><img src="https://img.shields.io/github/commit-activity/m/hasherezade/libpeconv" alt="Commit activity" class="inline"/></a> <a href="https://github.com/hasherezade/libpeconv/commits"><img src="https://img.shields.io/github/last-commit/hasherezade/libpeconv/master" alt="Last Commit" class="inline"/></a></p>
<p><a href="https://opensource.org/licenses/BSD-2-Clause"><img src="https://img.shields.io/badge/License-BSD%202--Clause-blue.svg" alt="License" style="pointer-events: none;" class="inline"/></a> <a href="https://github.com/hasherezade/libpeconv"><img src="https://img.shields.io/badge/Windows-0078D6?logo=windows" alt="Platform Badge" class="inline"/></a></p>
<p><em>A library to load and manipulate PE files.</em></p>
<h2>Objectives</h2>
<p>The goal of libPEConv was to create a "swiss army knife" for custom loading of PE files. It gathers various helper functions that you can quickly integrate in your own loader. For example: remapping sections, applying relocations, loading imports, parsing resources.</p>
<p>Not only it allows for loading PE files, but also for customizing of some steps, i.e. IAT hooking (by providing custom IAT resolvers), and functions redirection. Yet, it is NOT focused on inline hooking and should not be confused with libraries such as MS Detours or MinHook.</p>
<p>LibPeConv can be used for creating PE binders, as it allows to load a PE directly from the resource, and integrate it as if it was a local code.</p>
<p>As well it can help you in dumping PEs from the memory, and rebuilding their IATs.</p>
<h2>Basic example</h2>
<p><em>The simplest usecase</em>: use libPeConv to manually load and run an EXE of you choice.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;Windows.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="peconv_8h.html">peconv.h</a>&gt;</span> <span class="comment">// include libPeConv header</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (argc &lt; 2) {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;Args: &lt;path to the exe&gt;&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line">    LPCSTR pe_path = argv[1];</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// manually load the PE file using libPeConv:</span></div>
<div class="line">    <span class="keywordtype">size_t</span> v_size = 0;</div>
<div class="line"><span class="preprocessor">#ifdef LOAD_FROM_PATH</span></div>
<div class="line">    <span class="comment">//if the PE is dropped on the disk, you can load it from the file:</span></div>
<div class="line">    BYTE* my_pe = <a class="code hl_function" href="namespacepeconv.html#a1f22b6dd1ca4236e35406211291c7d52">peconv::load_pe_executable</a>(pe_path, v_size);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">    <span class="keywordtype">size_t</span> bufsize = 0;</div>
<div class="line">    BYTE *buffer = <a class="code hl_function" href="namespacepeconv.html#a245487a080f79725e2fb61c21045ea7b">peconv::load_file</a>(pe_path, bufsize);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// if the file is NOT dropped on the disk, you can load it directly from a memory buffer:</span></div>
<div class="line">    BYTE* my_pe = <a class="code hl_function" href="namespacepeconv.html#a1f22b6dd1ca4236e35406211291c7d52">peconv::load_pe_executable</a>(buffer, bufsize, v_size);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">    <span class="keywordflow">if</span> (!my_pe) {</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// if the loaded PE needs to access resources, you may need to connect it to the PEB:</span></div>
<div class="line">    <a class="code hl_function" href="namespacepeconv.html#a1b2f6b38a8631d42d6a7919f41de7e01">peconv::set_main_module_in_peb</a>((HMODULE)my_pe);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// load delayed imports (if present):</span></div>
<div class="line">    <span class="keyword">const</span> ULONGLONG load_base = (ULONGLONG)my_pe;</div>
<div class="line">    <a class="code hl_function" href="namespacepeconv.html#a160928436b4c34309ed3c2da10f8dc53">peconv::load_delayed_imports</a>(my_pe, load_base);</div>
<div class="line">  </div>
<div class="line">    <span class="comment">// if needed, you can run TLS callbacks before the Entry Point:</span></div>
<div class="line">    <a class="code hl_function" href="namespacepeconv.html#a0e2ff10a8a87a03dcdb0e2e029406c6b">peconv::run_tls_callbacks</a>(my_pe, v_size);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">//calculate the Entry Point of the manually loaded module</span></div>
<div class="line">    DWORD ep_rva = <a class="code hl_function" href="namespacepeconv.html#a12d3fa7eccb95cafc6d2be997965e97c">peconv::get_entry_point_rva</a>(my_pe);</div>
<div class="line">    <span class="keywordflow">if</span> (!ep_rva) {</div>
<div class="line">        <span class="keywordflow">return</span> -2;</div>
<div class="line">    }</div>
<div class="line">    ULONG_PTR ep_va = ep_rva + (ULONG_PTR) my_pe;</div>
<div class="line">    <span class="comment">//assuming that the payload is an EXE file (not DLL) this will be the simplest prototype of the main:</span></div>
<div class="line">    int (*new_main)() = (<span class="keywordtype">int</span>(*)())ep_va;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//call the Entry Point of the manually loaded PE:</span></div>
<div class="line">    <span class="keywordflow">return</span> new_main();</div>
<div class="line">}</div>
<div class="ttc" id="anamespacepeconv_html_a0e2ff10a8a87a03dcdb0e2e029406c6b"><div class="ttname"><a href="namespacepeconv.html#a0e2ff10a8a87a03dcdb0e2e029406c6b">peconv::run_tls_callbacks</a></div><div class="ttdeci">size_t run_tls_callbacks(IN PVOID modulePtr, IN size_t moduleSize=0, IN DWORD dwReason=DLL_PROCESS_ATTACH)</div><div class="ttdef"><b>Definition</b> <a href="tls__parser_8cpp_source.html#l00084">tls_parser.cpp:84</a></div></div>
<div class="ttc" id="anamespacepeconv_html_a12d3fa7eccb95cafc6d2be997965e97c"><div class="ttname"><a href="namespacepeconv.html#a12d3fa7eccb95cafc6d2be997965e97c">peconv::get_entry_point_rva</a></div><div class="ttdeci">DWORD get_entry_point_rva(IN const BYTE *pe_buffer)</div><div class="ttdef"><b>Definition</b> <a href="pe__hdrs__helper_8cpp_source.html#l00171">pe_hdrs_helper.cpp:171</a></div></div>
<div class="ttc" id="anamespacepeconv_html_a160928436b4c34309ed3c2da10f8dc53"><div class="ttname"><a href="namespacepeconv.html#a160928436b4c34309ed3c2da10f8dc53">peconv::load_delayed_imports</a></div><div class="ttdeci">bool load_delayed_imports(BYTE *modulePtr, const ULONGLONG moduleBase, t_function_resolver *func_resolver=nullptr)</div><div class="ttdef"><b>Definition</b> <a href="delayed__imports__loader_8cpp_source.html#l00101">delayed_imports_loader.cpp:101</a></div></div>
<div class="ttc" id="anamespacepeconv_html_a1b2f6b38a8631d42d6a7919f41de7e01"><div class="ttname"><a href="namespacepeconv.html#a1b2f6b38a8631d42d6a7919f41de7e01">peconv::set_main_module_in_peb</a></div><div class="ttdeci">bool set_main_module_in_peb(HMODULE hModule)</div><div class="ttdef"><b>Definition</b> <a href="peb__lookup_8cpp_source.html#l00159">peb_lookup.cpp:159</a></div></div>
<div class="ttc" id="anamespacepeconv_html_a1f22b6dd1ca4236e35406211291c7d52"><div class="ttname"><a href="namespacepeconv.html#a1f22b6dd1ca4236e35406211291c7d52">peconv::load_pe_executable</a></div><div class="ttdeci">BYTE * load_pe_executable(BYTE *payload_raw, size_t r_size, OUT size_t &amp;v_size, t_function_resolver *import_resolver=NULL)</div><div class="ttdef"><b>Definition</b> <a href="pe__loader_8cpp_source.html#l00080">pe_loader.cpp:80</a></div></div>
<div class="ttc" id="anamespacepeconv_html_a245487a080f79725e2fb61c21045ea7b"><div class="ttname"><a href="namespacepeconv.html#a245487a080f79725e2fb61c21045ea7b">peconv::load_file</a></div><div class="ttdeci">peconv::UNALIGNED_BUF load_file(IN LPCTSTR filename, OUT size_t &amp;r_size)</div><div class="ttdef"><b>Definition</b> <a href="file__util_8cpp_source.html#l00011">file_util.cpp:11</a></div></div>
<div class="ttc" id="apeconv_8h_html"><div class="ttname"><a href="peconv_8h.html">peconv.h</a></div><div class="ttdoc">Master include file, including everything else.</div></div>
</div><!-- fragment --><p> <em>See also: <a href="https://github.com/hasherezade/libpeconv_tpl/blob/master/project_template/main.cpp">https://github.com/hasherezade/libpeconv_tpl/blob/master/project_template/main.cpp</a></em></p>
<h2>Read more</h2>
<ul>
<li><a href="https://github.com/hasherezade/libpeconv/wiki">Wiki</a></li>
<li><a href="https://hasherezade.github.io/libpeconv/">Docs</a></li>
<li><a href="https://github.com/hasherezade/libpeconv/tree/master/tests">Examples</a></li>
<li><a href="https://hshrzd.wordpress.com/tag/libpeconv/">Tutorials</a></li>
<li><a href="https://github.com/hasherezade/libpeconv_project_template">Project template</a> </li>
</ul>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed May 31 2023 13:31:26 for libPeConv by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7
</small></address>
</body>
</html>
